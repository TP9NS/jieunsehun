<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en" data-bs-theme="auto">
  <head>
    <script src="/docs/5.3/assets/js/color-modes.js"></script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.118.2">
    <title>ìš°ë¦¬ì˜ ë³´ë¬¼ ì§€ë„ì™€ GPT ëŒ€í™”</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/album/">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

      .b-example-divider {
        width: 100%;
        height: 3rem;
        background-color: rgba(0, 0, 0, .1);
        border: solid rgba(0, 0, 0, .15);
        border-width: 1px 0;
        box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
      }

      .b-example-vr {
        flex-shrink: 0;
        width: 1.5rem;
        height: 100vh;
      }

      .bi {
        vertical-align: -.125em;
        fill: currentColor;
      }

      .nav-scroller {
        position: relative;
        z-index: 2;
        height: 2.75rem;
        overflow-y: hidden;
      }

      .nav-scroller .nav {
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        margin-top: -1px;
        overflow-x: auto;
        text-align: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }

      .btn-bd-primary {
        --bd-violet-bg: #712cf9;
        --bd-violet-rgb: 112.520718, 44.062154, 249.437846;

        --bs-btn-font-weight: 600;
        --bs-btn-color: var(--bs-white);
        --bs-btn-bg: var(--bd-violet-bg);
        --bs-btn-border-color: var(--bd-violet-bg);
        --bs-btn-hover-color: var(--bs-white);
        --bs-btn-hover-bg: #6528e0;
        --bs-btn-hover-border-color: #6528e0;
        --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);
        --bs-btn-active-color: var(--bs-btn-hover-color);
        --bs-btn-active-bg: #5a23c8;
        --bs-btn-active-border-color: #5a23c8;
      }

      .bd-mode-toggle {
        z-index: 1500;
      }

      .bd-mode-toggle .dropdown-menu .active .bi {
        display: block !important;
      }
      #chatbox {
        width: 300px;
        height: 670px;
        border-radius: 10px; /* ëª¨ì„œë¦¬ë¥¼ ë‘¥ê¸€ê²Œ */
  border: 1px solid #e0e0e0; /* ì—°í•œ íšŒìƒ‰ í…Œë‘ë¦¬ */
        padding: 10px;
      }
      
      #chatbox .messages {
      color: white;
  height: 560px;
  overflow-y: auto;
  background-color: #f9f9f9; /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
  border-radius: 5px; /* ë©”ì‹œì§€ ë°•ìŠ¤ ë‘¥ê·¼ ëª¨ì„œë¦¬ */
  border: 1px solid #ddd; /* ë©”ì‹œì§€ ë°•ìŠ¤ í…Œë‘ë¦¬ */
  padding: 10px;
  margin-bottom: 10px;

  /* GPT ì´ë¯¸ì§€ ì¶”ê°€ */
  background-image: url('/images/gpt.png'); /* gpt.pngë¥¼ ë°°ê²½ ì´ë¯¸ì§€ë¡œ ì„¤ì • */
  background-size: contain; /* ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì»¨í…Œì´ë„ˆì— ë§ì¶¤ */
  background-position: center; /* ì´ë¯¸ì§€ ì¤‘ì•™ ì •ë ¬ */
  background-repeat: no-repeat; /* ì´ë¯¸ì§€ë¥¼ ë°˜ë³µí•˜ì§€ ì•ŠìŒ */
}

      /* ì‚¬ìš©ì ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
#user-input {
  padding: 10px; /* í…ìŠ¤íŠ¸ ì…ë ¥ ê³µê°„ ë‚´ë¶€ ì—¬ë°± */
  font-size: 16px; /* ì…ë ¥ í…ìŠ¤íŠ¸ í¬ê¸° */
  border: 1px solid #ddd; /* ì…ë ¥ì°½ í…Œë‘ë¦¬ */
  border-radius: 5px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
  outline: none; /* í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ì œê±° */
  transition: border-color 0.3s ease; /* í¬ì»¤ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
}
      
      #chatbox input {
        width: 100%;
        padding: 10px;
      }

      .map-container {
    position: relative;
    display: flex;
    flex-direction: column;
    width: 900px;
    height: 700px;
    margin-top: 0;
}

.search-box {
    position: absolute;
    top: 0;
    width: 100%;
    display: flex;
    justify-content: center;
    padding: 0px;
    background-color: white; /* Optional: Adds background to make it stand out */
    z-index: 1;
}

#map {
    flex: 1;
    margin-top: 50px; /* Adjust this if there is any overlap */
    width: 100%;
    height: 100%;
}


      .search-box input {
        flex: 1;
        padding: 10px;
      }

      .search-box button {
        padding: 10px;
      }

      .saved-coordinates {
        margin-top: 20px;
      }

      .container {
        display: flex;
      }
      .container2 {
        display: block;
        max-width: 2000px;
      }
.map_wrap, .map_wrap * {
    margin: 0;
    padding: 0;
    font-family: 'Malgun Gothic', dotum, 'ë‹ì›€', sans-serif;
    font-size: 12px;
}

.map_wrap a, .map_wrap a:hover, .map_wrap a:active {
    color: #000;
    text-decoration: none;
}

.map_wrap {
    position: relative;
    width: 1200px; 
    height: 620px;
    float: none; /* ë‚˜ë€íˆ ë°°ì¹˜í•˜ì§€ ì•ŠìŒ */
  display: block;
}

#menu_wrap {
    position: absolute;
    top: 120px;
    left: 0;
    bottom: 0;
    margin-bottom: 20px;
    width: 300px;
    height: calc(100% - 70px); /* ìƒë‹¨ê³¼ í•˜ë‹¨ ê°„ê²© ê³ ë ¤ */
    margin: 10px 0 30px 10px;
    padding: 5px;
    overflow-y: auto;
    background: rgba(255, 255, 255, 0.9);
    z-index: 1;
    font-size: 12px;
    border-radius: 10px;
}

.overlaybox {
    padding: 10px;
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.overlaybox ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.overlaybox li {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.overlaybox img {
    width: 40px;
    height: 40px;
    border-radius: 4px;
    margin-right: 10px;
}

#placesList li {list-style: none;}
#placesList .item {position:relative;border-bottom:1px solid #888;overflow: hidden;cursor: pointer;min-height: 65px;}
#placesList .item span {display: block;margin-top:4px;}
#placesList .item h5, #placesList .item .info {text-overflow: ellipsis;overflow: hidden;white-space: nowrap;}
#placesList .item .info{padding:10px 0 10px 55px;}
#placesList .info .gray {color:#8a8a8a;}
#placesList .info .jibun {padding-left:26px;background:url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/places_jibun.png) no-repeat;}
#placesList .info .tel {color:#009900;}
#placesList .info .category {color:#009900;}
#placesList .item .markerbg {float:left;position:absolute;width:36px; height:37px;margin:10px 0 0 10px;background:url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png) no-repeat;}
#placesList .item .marker_1 {background-position: 0 -10px;}
#placesList .item .marker_2 {background-position: 0 -56px;}
#placesList .item .marker_3 {background-position: 0 -102px}
#placesList .item .marker_4 {background-position: 0 -148px;}
#placesList .item .marker_5 {background-position: 0 -194px;}
#placesList .item .marker_6 {background-position: 0 -240px;}
#placesList .item .marker_7 {background-position: 0 -286px;}
#placesList .item .marker_8 {background-position: 0 -332px;}
#placesList .item .marker_9 {background-position: 0 -378px;}
#placesList .item .marker_10 {background-position: 0 -423px;}
#placesList .item .marker_11 {background-position: 0 -470px;}
#placesList .item .marker_12 {background-position: 0 -516px;}
#placesList .item .marker_13 {background-position: 0 -562px;}
#placesList .item .marker_14 {background-position: 0 -608px;}
#placesList .item .marker_15 {background-position: 0 -654px;}
#pagination {margin:10px auto;text-align: center;}
#pagination a {display:inline-block;margin-right:10px;}
#pagination .on {font-weight: bold; cursor: default;color:#777;}
.wrap {
    position: absolute;
    left: 0;
    bottom: 40px;
    width: 400px;
    height: 450px; /* ë†’ì´ ì¦ê°€ */
    margin-left: -144px;
    text-align: left;
    overflow: auto; /* ë‚´ë¶€ ìš”ì†Œê°€ ë„˜ì¹˜ë©´ ìŠ¤í¬ë¡¤ ì¶”ê°€ */
    font-size: 12px;
    font-family: 'Malgun Gothic', dotum, 'ë‹ì›€', sans-serif;
    line-height: 1.5;
}

.wrap * {
    padding: 0;
    margin: 0;
}

.wrap .info {
    width: 100%; /* ë¶€ëª¨ ìš”ì†Œ í¬ê¸°ì™€ ë™ì¼í•˜ê²Œ */
    height: auto; /* ë‚´ë¶€ ìš”ì†Œì— ë”°ë¼ ë†’ì´ ìë™ ì¡°ì • */
    border-radius: 5px;
    border-bottom: 2px solid #ccc;
    border-right: 1px solid #ccc;
    overflow: visible; /* ë²„íŠ¼ê³¼ ë‹¤ë¥¸ ìš”ì†Œê°€ ìˆ¨ê²¨ì§€ì§€ ì•Šë„ë¡ ì„¤ì • */
    background: #fff;
    padding: 10px; /* ë‚´ë¶€ ì—¬ë°± ì¶”ê°€ */
    box-sizing: border-box; /* íŒ¨ë”© í¬í•¨ í¬ê¸° ê³„ì‚° */
}

.wrap .info:nth-child(1) {
    border: 0;
    box-shadow: 0px 1px 2px #888;
}

.info .title {
    padding: 5px 10px; /* ì¢Œìš° ì—¬ë°± ì¶”ê°€ */
    height: auto; /* ì œëª© ë†’ì´ ìë™ ì¡°ì • */
    background: #eee;
    border-bottom: 1px solid #ddd;
    font-size: 18px;
    font-weight: bold;
}

.info .close {
    position: absolute;
    top: 5px;
    right: 10px;
    color: #888;
    width: 17px;
    height: 17px;
    background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/overlay_close.png');
    cursor: pointer; /* ë§ˆìš°ìŠ¤ í¬ì¸í„° */
}

.info .close:hover {
    color: #000; /* í˜¸ë²„ ì‹œ ìƒ‰ìƒ ë³€ê²½ */
}

.info .body {
    position: relative;
    overflow: auto; /* ìŠ¤í¬ë¡¤ ì¶”ê°€ */
}

.info .desc {
    position: relative;
    margin: 10px 0; /* ìƒë‹¨ ì—¬ë°± */
    height: auto; /* ë†’ì´ ìë™ ì¡°ì • */
    line-height: 1.5;
}

.desc .ellipsis {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.desc .jibun {
    font-size: 11px;
    color: #888;
    margin-top: -2px;
}

.info .img {
    position: absolute;
    top: 6px;
    left: 5px;
    width: 73px;
    height: 71px;
    border: 1px solid #ddd;
    color: #888;
    overflow: hidden;
}

.info:after {
    content: '';
    position: absolute;
    margin-left: -12px;
    left: 50%;
    bottom: 0;
    width: 22px;
    height: 12px;
    background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png');
}

.info .link {
    color: #5085BB;
}

.wrap .info button {
    display: block;
    width: 100px; /* ë²„íŠ¼ì´ ì…ë ¥ í•„ë“œì™€ ë™ì¼í•œ ë„ˆë¹„ */
    margin-top: 10px; /* ë²„íŠ¼ ìƒë‹¨ ì—¬ë°± */
    padding: 10px;
    background-color: #007bff; /* íŒŒë€ìƒ‰ ë°°ê²½ */
    color: white; /* í°ìƒ‰ ê¸€ì */
    border: none; /* í…Œë‘ë¦¬ ì œê±° */
    border-radius: 5px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
    font-size: 14px;
    cursor: pointer; /* í´ë¦­ ê°€ëŠ¥í•œ í¬ì¸í„° */
    text-align: center;
}

.wrap .info button:hover {
    background-color: #0056b3; /* í˜¸ë²„ ì‹œ ìƒ‰ìƒ ë³€ê²½ */
}

.input {
    width: 300px; /* ì›í•˜ëŠ” ë„ˆë¹„ë¡œ ì„¤ì • */
    height: 20px; /* ì›í•˜ëŠ” ë†’ì´ë¡œ ì„¤ì • */
    padding: 5px; /* ë‚´ë¶€ ì—¬ë°± ì¡°ì • */
    border: 1px solid #ccc; /* í…Œë‘ë¦¬ ì„¤ì • */
    border-radius: 4px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
    font-size: 12px; /* ê¸€ì í¬ê¸° ì„¤ì • */
    margin: 2px 0; /* ì…ë ¥ í•„ë“œ ê°„ì˜ ê°„ê²© ì¡°ì • */
}
.review-section {
    margin-top: 20px; /* ìœ„ì™€ì˜ ê°„ê²© */
    padding: 20px;
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}


/* ë¦¬ë·° ì‘ì„± ì„¹ì…˜ */
.review-form {
    margin-top: 20px;
    padding: 15px;
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    max-width: 100%;
}

.review-form .rating-stars {
    display: flex;
    gap: 5px;
    margin-bottom: 15px;
    justify-content: start;
    align-items: center;
}

.review-form .rating-stars span {
    font-size: 30px; /* ë³„ í¬ê¸° */
    cursor: pointer;
    color: #ffc107; /* ì„ íƒëœ ë³„ ìƒ‰ìƒ */
    transition: all 0.3s ease-in-out;
}

/* ì„ íƒë˜ì§€ ì•Šì€ ë³„ì€ 'â˜†' */
.review-form .rating-stars span::before {
    content: 'â˜†'; /* ê¸°ë³¸ ë¹ˆ ë³„ */
}

/* ì„ íƒëœ ë³„ì€ 'â˜…' */
.review-form .rating-stars span.selected::before {
    content: 'â˜…'; /* ì±„ì›Œì§„ ë³„ */
}



.review-form textarea {
    width: 100%;
    height: 80px;
    resize: none;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 10px;
    margin-top: 10px;
}


.review-form button {
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 10px 20px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s ease-in-out;
}

.review-form button:hover {
    background-color: #0056b3;
}

/* ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ */
.review-list {
    margin-top: 20px;
    padding: 10px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    max-height: 200px;
    overflow-y: auto;
}

.review-list .review-item {
    padding: 15px 0;
    border-bottom: 1px solid #eee;
}

.review-list .review-item:last-child {
    border-bottom: none;
}

.review-list .review-author {
    font-weight: bold;
    font-size: 15px;
    color: #333;
    margin-bottom: 5px;
}

.review-list .review-rating {
    color: #ffc107; /* ë³„ì  ìƒ‰ìƒ */
    font-size: 14px;
    margin-bottom: 5px;
}

.review-list .review-text {
    font-size: 14px;
    color: #555;
    line-height: 1.5;
}

/* ë³„ì  í‰ê·  */
.average-rating {
    display: flex;
    align-items: center;
    font-size: 16px;
    color: #333;
    margin-bottom: 15px;
}

.average-rating .stars {
    margin-right: 10px;
    color: #ffc107; /* ë³„ì  ìƒ‰ìƒ */
    font-size: 20px;
}

.average-rating .value {
    font-weight: bold;
    font-size: 18px;
}
.rating-stars {
    display: inline-flex;
    gap: 5px; /* ë³„ ì‚¬ì´ ê°„ê²© */
}

.rating-stars span {
    font-size: 24px; /* ë³„ í¬ê¸° */
    color: #ffc107; /* ì±„ì›Œì§„ ë³„ ìƒ‰ìƒ */
}

.rating-stars span::before {
    content: 'â˜†'; /* ê¸°ë³¸ ë¹ˆ ë³„ */
}

.rating-stars span.filled::before {
    content: 'â˜…'; /* ì±„ì›Œì§„ ë³„ */
}

.rating-stars span.half::before {
    content: 'â˜…'; /* ë°˜ìª½ ë³„ë„ ë™ì¼í•˜ê²Œ í‘œì‹œ */
    color: #ffc107;
    clip-path: inset(0 50% 0 0); /* ì™¼ìª½ ì ˆë°˜ë§Œ ì±„ìš°ê¸° */
}

.badge {
    font-size: 10px;
    color: white;
    padding: 5px 7px;
    border-radius: 50%;
    position: absolute;
}
#admin-places {
  padding: 20px;
  background-color: #f9f9f9; /* ë°°ê²½ìƒ‰ */
  border-radius: 10px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì */
}
#admin-places h3 {
  margin-bottom: 20px;
  font-size: 1.8rem;
}
#admin-places .form-select {
  max-width: 300px; /* ë“œë¡­ë‹¤ìš´ í¬ê¸° ì œí•œ */
  margin: 0 auto;
}
.card {
 height: 100%; /* ì¹´ë“œì˜ ë†’ì´ë¥¼ ê³ ì • */
 display: flex;
  flex-direction: column;
  justify-content: space-between;
  border: 1px solid #dee2e6;
  border-radius: 10px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

.card-img-top {
height: 200px; /* ì´ë¯¸ì§€ ê³ ì • ë†’ì´ */
width: 309px;
  object-fit: cover; /* ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€í•˜ë©° ìë¥´ê¸° */
  border-top-left-radius: 10px; /* ì´ë¯¸ì§€ ëª¨ì„œë¦¬ë¥¼ ë‘¥ê¸€ê²Œ */
  border-top-right-radius: 10px;
}

.card-body {

  padding: 20px;
}

.card-title {
  font-size: 1.2rem;
  font-weight: bold;
}

.card-text {
  font-size: 0.9rem;
  color: #6c757d;
}
#place-list {
  margin-top: 30px; /* ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ì™€ ë“œë¡­ë‹¤ìš´ ì‚¬ì´ ê°„ê²© */
}

#place-list .col {
  min-height: 400px; /* ì¹´ë“œ ìµœì†Œ ë†’ì´ ì„¤ì • */
  display: flex;
  justify-content: center;
  align-items: stretch; /* ì¹´ë“œ ë†’ì´ ê· ì¼í™” */
}

.layout-container {
  display: flex; /* ë‚˜ë€íˆ ë°°ì¹˜ */
  flex-direction: row; /* ìˆ˜í‰ ì •ë ¬ */
  width: 100%; /* ì „ì²´ ë„ˆë¹„ */
  height: 100vh; /* í™”ë©´ ì „ì²´ ë†’ì´ */
  gap: 20px; /* ìš”ì†Œ ì‚¬ì´ ê°„ê²© */
  box-sizing: border-box;
}
.button-icon {
  width: 35px; /* ì•„ì´ì½˜ í¬ê¸° */
  height: 35px; /* ì•„ì´ì½˜ í¬ê¸° */
  vertical-align: middle; /* ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ì˜ ì„¸ë¡œ ì •ë ¬ */
  border-radius: 5px;
}



/* ê¸°ë³¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.btn-primary {
  background-color: #4a90e2; /* ë²„íŠ¼ ë°°ê²½ìƒ‰ */
  color: white; /* ë²„íŠ¼ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
  border: 1px solid #4a90e2; /* ë²„íŠ¼ í…Œë‘ë¦¬ ìƒ‰ìƒ */
  border-radius: 8px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
  font-size: 16px; /* í…ìŠ¤íŠ¸ í¬ê¸° */
  font-weight: 600; /* í…ìŠ¤íŠ¸ êµµê¸° */
  padding: 10px 20px; /* ë‚´ë¶€ ì—¬ë°± */
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì íš¨ê³¼ */
  transition: background-color 0.3s ease, transform 0.2s ease; /* ì• ë‹ˆë©”ì´ì…˜ */
}

/* ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
.btn-primary:hover {
  background-color: #3a78c1; /* í˜¸ë²„ ì‹œ ë°°ê²½ìƒ‰ */
  border-color: #3a78c1; /* í˜¸ë²„ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ */
  transform: translateY(-2px); /* ì•½ê°„ ìœ„ë¡œ ì´ë™ */
}

/* ë²„íŠ¼ í´ë¦­(í™œì„±í™”) ìƒíƒœ */
.btn-primary:active {
  background-color: #336699; /* í´ë¦­ ì‹œ ë°°ê²½ìƒ‰ */
  border-color: #336699; /* í´ë¦­ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ */
  transform: translateY(2px); /* í´ë¦­ ì‹œ ì•„ë˜ë¡œ ëˆŒë¦° íš¨ê³¼ */
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* ëˆŒë¦° ìƒíƒœì˜ ê·¸ë¦¼ì */
}

/* ë²„íŠ¼ ê°„ ê°„ê²© */
.me-2 {
  margin-right: 8px; /* ì˜¤ë¥¸ìª½ ê°„ê²© */
}


</style>
</head>
<body>
    <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
      <symbol id="check2" viewBox="0 0 16 16">
        <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
      </symbol>
      <symbol id="circle-half" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
      </symbol>
      <symbol id="moon-stars-fill" viewBox="0 0 16 16">
        <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
      </symbol>
      <symbol id="sun-fill" viewBox="0 0 16 16">
        <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
      </symbol>
    </svg>
<body th:data-user-permission="${session.permission}">
<body th:data-user-id="${userId}" th:data-user-permission="${userPermission}">

<script>
document.addEventListener("DOMContentLoaded", function () {
    const userId = document.body.getAttribute("data-user-id"); // userIdë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤
    const userPermission = parseInt(document.body.getAttribute("data-user-permission"), 10); // userPermission ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤

    console.log("User ID:", userId);
    console.log("User Permission:", userPermission);

    // ë¹„ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    if (!userId || isNaN(userPermission)) {
        console.log("User is not logged in. Restricting access to protected links.");

        // ì œí•œí•  ë§í¬(ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… ì œì™¸)
        const restrictedLinks = document.querySelectorAll('a.nav-link:not([href="/user/login"]):not([href="/user/signup"])');
        restrictedLinks.forEach(link => {
            link.addEventListener('click', function (event) {
                event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ì°¨ë‹¨
                alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."); // ì•Œë¦¼ í‘œì‹œ
            });
        });

        // ì œí•œí•  ë²„íŠ¼ë“¤ ë¹„í™œì„±í™”
        const restrictedButtons = document.querySelectorAll('button:not(.always-active)');
        restrictedButtons.forEach(button => {
            button.disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™”
            button.addEventListener('click', function () {
                alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."); // í´ë¦­ ì‹œ ì•Œë¦¼ í‘œì‹œ
            });
        });

        console.log("Unrestricted login and signup buttons.");
    } else if (userPermission === 1 || userPermission === 0) {
        console.log("User is logged in with permission:", userPermission);

        // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì™€ ê´€ë¦¬ìëŠ” ì œí•œ ì—†ìŒ. ëª¨ë“  ë²„íŠ¼ í™œì„±í™”.
        const restrictedButtons = document.querySelectorAll('button');
        restrictedButtons.forEach(button => {
            button.disabled = false; // ë²„íŠ¼ í™œì„±í™”
        });

        console.log("All buttons are active.");
    } else {
        console.error("Unexpected user permission value:", userPermission);
    }
});

</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const userPermission = parseInt(document.body.getAttribute("data-user-permission"), 10);
    const chatbox = document.getElementById("chatbox");
    const adminMapPointsForm = document.getElementById("adminMapPointsForm");

    // chatboxëŠ” ê´€ë¦¬ìì¼ ê²½ìš° ìˆ¨ê¸°ê³ , ì¥ì†Œ ë¦¬ìŠ¤íŠ¸(adminMapPointsForm)ëŠ” í•­ìƒ í‘œì‹œ
    if (chatbox && userPermission === 0) {
        chatbox.style.display = "none"; // ê´€ë¦¬ìì¸ ê²½ìš° chatbox ìˆ¨ê¹€
    }
    
    if (adminMapPointsForm) {
        adminMapPointsForm.style.display = "block"; // ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ëŠ” í•­ìƒ í‘œì‹œ
    }
});
</script>

<header data-bs-theme="dark">
  <div class="collapse text-bg-dark" id="navbarHeader">
    <div class="container">
      <div class="row">
        <div class="col-sm-8 col-md-7 py-4">
          <h4>About</h4>
          <p class="text-body-secondary">ìš°ë¦¬ë“¤ì˜ ë³´ë¬¼ì§€ë„ì— ì˜¨ ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</p>
        </div>
        <div class="col-sm-4 offset-md-1 py-4">
          <h4>Contact</h4>
          <ul class="list-unstyled">
            <li><a href="#" class="text-white">Follow on Twitter</a></li>
            <li><a href="#" class="text-white">Like on Facebook</a></li>
            <li><a href="#" class="text-white">Email me</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  
  <div class="navbar navbar-dark bg-dark shadow-sm">
    <div class="container d-flex align-items-center justify-content-between">
      <!-- ë³´ë¬¼ ì§€ë„ ë¡œê³ ë¥¼ ìƒë‹¨ì— ê³ ì • -->
      <a href="/main" class="navbar-brand">
        <strong>ë³´ë¬¼ ì§€ë„</strong>
        <img src=/images/ë³´ë¬¼ì§€ë„ë¡œê³ .png alt="ë³´ë¬¼ ì§€ë„ ë¡œê³ " width="55" height="55" class="me-2">
      </a>

      <!-- ë¡œê³  ì•„ë˜ ê°€ë¡œë¡œ ë©”ë‰´ì™€ ë²„íŠ¼ ë°°ì¹˜ -->
      <div class="d-flex justify-content-between w-100 mt-2">
        <ul class="navbar-nav flex-row">

          <li class="nav-item me-3">
            <a class="nav-link" href="/board">ê²Œì‹œíŒ</a>
          </li>
          <li class="nav-item me-3">
            <a class="nav-link" href="/mymap">ë‚˜ë§Œì˜ ì§€ë„</a>
          </li>
          <li class="nav-item me-3">
            <a class="nav-link" href="/groupmap">ê·¸ë£¹ ì§€ë„</a>
          </li>
          <li class="nav-item me-3">
            <a class="nav-link" href="/friends">ì¹œêµ¬ ëª©ë¡</a>
            <span id="friend-badge" class="badge bg-danger" style="display: none; position: relative; top: -55px; left: 60px;">0</span>
          </li>
          <li class="nav-item me-3">
            <a class="nav-link" href="/groups">ê·¸ë£¹ ê´€ë¦¬</a>
            <span id="group-badge" class="badge bg-danger" style="display: none; position: relative; top: -55px; left: 60px;">0</span>
          </li>
          <li class="nav-item me-3">
            <a class="nav-link" href="/friends/messages/inbox">ìª½ì§€í•¨</a>
            <span id="message-badge" class="badge bg-danger" style="display: none; position: relative; top: -55px; left: 40px;">0</span>
          </li>
          <li class="nav-item me-3">
            <a class="nav-link" href="/vote">ì¥ì†Œ íˆ¬í‘œ</a>
          </li>
        </ul>

        <!-- ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ë²„íŠ¼ í‘œì‹œ -->
        <ul class="navbar-nav flex-row">
  <!-- ë¡œê·¸ì¸ì´ ë˜ì–´ ìˆì„ ë•Œ -->
  <li th:if="${session.user_id != null}" class="nav-item me-3">
    <a class="nav-link" th:if="${session.permission == 0}" th:href="@{/user/manage-locations}">ê´€ë¦¬ìë‹˜ ì–´ì„œì˜¤ì„¸ìš”!</a>
    <a class="nav-link" th:if="${session.permission != 0}" th:href="@{/user/mypage}">ë§ˆì´í˜ì´ì§€</a>
  </li>
  		<li th:if="${session.permission == 0}" class="nav-item me-3">
  		<a class="nav-link" th:href="@{/admin/manageuser}">ìœ ì € ê´€ë¦¬</a>
  		</li>
  <li th:if="${session.permission == 0}" class="nav-item me-3">
    <a class="nav-link" th:href="@{/user/report}">ì‹ ê³  ê´€ë¦¬</a>
  </li>
  <li th:if="${session.user_id != null}" class="nav-item">
    <a class="nav-link" th:href="@{/user/logout}">ë¡œê·¸ì•„ì›ƒ</a>
  </li>

  <!-- ë¡œê·¸ì¸ì´ ë˜ì–´ ìˆì§€ ì•Šì„ ë•Œ -->
  <li th:unless="${session.user_id != null}" class="nav-item me-3">
    <a class="nav-link" th:href="@{/user/login}">ë¡œê·¸ì¸</a>
  </li>
  <li th:unless="${session.user_id != null}" class="nav-item">
    <a class="nav-link" th:href="@{/user/signup}">íšŒì›ê°€ì…</a>
  </li>
</ul>
      </div>
    </div>
  </div>
</header>
<main class="container2">
<div class="layout-container" style="margin-bottom: 10px;">
  <!-- ì§€ë„ ì„¹ì…˜ -->
  <div class="map_wrap">
    <div id="map" style="width:100%;height:100%;position:relative;overflow:hidden;"></div>
    <div class="container mt-3 d-flex justify-content-center" style="position: absolute; top: -10px; width: 100%; z-index: 1;">
      <button class="btn btn-primary me-2" onclick="findmyLocation('')">
<img src="/images/ë‚´ìœ„ì¹˜.png" alt="ë‚´ìœ„ì¹˜ ì•„ì´ì½˜" class="button-icon"> ë‚´ ìœ„ì¹˜
</button>
      <button class="btn btn-primary me-2" onclick="searchCategory('ìŒì‹ì ')">
  <img src="/images/ìŒì‹ì .png" alt="ìŒì‹ì  ì•„ì´ì½˜" class="button-icon"> ìŒì‹ì 
</button>
      <button class="btn btn-primary me-2" onclick="searchCategory('ì¹´í˜')">
       <img src="/images/ì¹´í˜.png" alt="ì¹´í˜ ì•„ì´ì½˜" class="button-icon"> ì¹´í˜
</button>
      <button class="btn btn-primary me-2" onclick="searchCategory('ì€í–‰')">
<img src="/images/ì€í–‰.png" alt="ì€í–‰ ì•„ì´ì½˜" class="button-icon"> ì€í–‰
</button>
      <button class="btn btn-primary me-2" onclick="searchCategory('ì•½êµ­')">
      <img src="/images/ì•½êµ­.png" alt="ì•½êµ­ ì•„ì´ì½˜" class="button-icon"> ì•½êµ­
</button>
      <button class="btn btn-primary me-2" onclick="searchCategory('ì£¼ìœ ì†Œ')">
<img src="/images/ì£¼ìœ ì†Œ.png" alt="ì£¼ìœ ì†Œ ì•„ì´ì½˜" class="button-icon"> ì£¼ìœ ì†Œ
</button>
      <button class="btn btn-primary me-2" onclick="searchCategory('í¸ì˜ì ')">
<img src="/images/í¸ì˜ì .png" alt="í¸ì˜ì  ì•„ì´ì½˜" class="button-icon"> í¸ì˜ì 
</button>
      <button class="btn btn-primary me-2" onclick="searchCategory('ë§ˆíŠ¸')">
      <img src="/images/ë§ˆíŠ¸.png" alt="ë§ˆíŠ¸ ì•„ì´ì½˜" class="button-icon"> ë§ˆíŠ¸
</button>
      <button class="btn btn-primary" onclick="searchCategory('íŒ¨ì…˜')">
      <img src="/images/ì‡¼í•‘ëª°.png" alt="ì‡¼í•‘ëª° ì•„ì´ì½˜" class="button-icon"> ì‡¼í•‘ëª°
</button>
    </div>

    <div id="menu_wrap" class="bg_white" style="position: absolute; top: 70px; left: 10px; z-index: 2;">
      <div class="option">
        <form onsubmit="searchPlaces(); return false;">
          í‚¤ì›Œë“œ : <input type="text" value="ì´íƒœì› ë§›ì§‘" id="keyword" size="15">
          <button type="submit">ê²€ìƒ‰í•˜ê¸°</button>
        </form>
      </div>
      <hr>
      <ul id="placesList"></ul>
      <div id="pagination"></div>
    </div>
  </div>

  <!-- GPT ì±„íŒ… ë°•ìŠ¤ -->
  <div id="chatbox">
   <h6>ê¶ê¸ˆí•œ ê²ƒì„ ChatGPTì—ê²Œ ë¬¼ì–´ë³´ì„¸ìš”!</h6>
    <div class="messages" id="messages">
      <!-- ëŒ€í™” ê¸°ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>
    <input type="text" id="user-input" placeholder="GPTì™€ ëŒ€í™”í•˜ì„¸ìš”..." onkeypress="sendMessage(event)">
  </div>
</div>


<div id="admin-places" class="container my-3">
  <!-- ìƒë‹¨ ì œëª© ë° ë“œë¡­ë‹¤ìš´ ì»¨í…Œì´ë„ˆ -->
  <div id="admin-header" class="text-center mb-3">
    <h5 class="text-primary">ğŸ“ ê´€ë¦¬ìê°€ ì¶”ì²œí•˜ëŠ” ì¥ì†Œ ğŸ“</h5>
    <div class="mt-3">
      <label for="topicFilter" class="form-label fw-bold">ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”:</label>
      <select id="topicFilter" class="form-select d-inline-block w-50">
        <option value="ALL">ì „ì²´</option>
        <th:block th:each="topic : ${distinctTopics}">
          <option th:value="${topic}" th:text="${topic}"></option>
        </th:block>
        <option value="NONE">ì—†ìŒ</option>
      </select>
    </div>
  </div>

  <!-- ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ -->
  <div id="place-list" class="container mt-4">
    <div class="row row-cols-1 row-cols-md-3 g-4">
      <th:block th:each="point : ${adminMapPoints}">
        <div class="col" th:attr="data-topic-th=${point.topic}">
          <div class="card shadow-sm h-100">
            <img th:src="${point.imageUrl}" alt="Image" class="card-img-top" style="height: 200px; object-fit: cover;">
            <div class="card-body text-center">
              <h5 class="card-title" th:text="${point.locationName}">ì¥ì†Œ ì´ë¦„</h5>
              <p class="card-text text-muted" th:text="'ì£¼ì œ: ' + ${point.topic}">ì£¼ì œ</p>
              <p class="card-text text-muted" th:text="'ì„¤ëª…: ' + ${point.locationAlias}">ì„¤ëª…</p>
              <p class="card-text text-muted" th:text="'ì£¼ì†Œ: ' + ${point.address}">ì£¼ì†Œ</p>
              <p class="card-text text-muted" th:text="'ì „í™”ë²ˆí˜¸: ' + ${point.phone}">ì „í™”ë²ˆí˜¸</p>
              <a href="javascript:void(0);" 
                 class="btn btn-primary btn-sm mt-2 location-link"
                 th:data-lat="${point.latitude}"
                 th:data-lng="${point.longitude}"
                 th:data-name="${point.locationName}">ì§€ë„ì—ì„œ ë³´ê¸°</a>
            </div>
          </div>
        </div>
      </th:block>
    </div>
  </div>
</div>

</main>
<script type="text/javascript">
//JavaScript to retrieve user permission dynamically
const userPermission = parseInt(document.body.getAttribute("data-user-permission"), 10);
console.log("User Permission:", userPermission);

</script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5e206128c9bbc2a5a6512679610c9ef8&libraries=services"></script>
<script>
	
	document.addEventListener('DOMContentLoaded', () => {
    console.log('DOMContentLoaded ì´ë²¤íŠ¸ í˜¸ì¶œë¨');
    checkNotifications();
});
setInterval(checkNotifications, 10000);
 
// ë§ˆì»¤ë¥¼ ë‹´ì„ ë°°ì—´ì…ë‹ˆë‹¤
var markers = [];

var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
    mapOption = {
        center: new kakao.maps.LatLng(37.566826, 126.9786567), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
        level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
    };  

// ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤    
var map = new kakao.maps.Map(mapContainer, mapOption); 

// ì¥ì†Œ ê²€ìƒ‰ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
var ps = new kakao.maps.services.Places();  

// ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡ì´ë‚˜ ë§ˆì»¤ë¥¼ í´ë¦­í–ˆì„ ë•Œ ì¥ì†Œëª…ì„ í‘œì¶œí•  ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
var infowindow = new kakao.maps.InfoWindow({zIndex:1});

var currentInfowindow = null;

var currentOverlay = null;

//ì¹´í…Œê³ ë¦¬ ì½”ë“œ ë§¤í•‘
const categoryCodes = {
    "ìŒì‹ì ": "FD6",
    "ì¹´í˜": "CE7",
    "ì€í–‰": "BK9",
    "ì•½êµ­": "PM9",
    "ì£¼ìœ ì†Œ": "OL7",
    "í¸ì˜ì ": "CS2",
    "ë§ˆíŠ¸": "MT1",
    "íŒ¨ì…˜": "SM1"
};

//ì¹´í…Œê³ ë¦¬ë¡œ ì¥ì†Œ ê²€ìƒ‰ í•¨ìˆ˜
function searchCategory(categoryName) {
    const categoryCode = categoryCodes[categoryName];
    if (!categoryCode) {
        alert("ì˜ëª»ëœ ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.");
        return;
    }

    var center = map.getCenter(); // ê²€ìƒ‰ ì „ í˜„ì¬ ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œë¥¼ ì €ì¥
    var radius = 3000; // ê²€ìƒ‰ ë°˜ê²½

    // ì¹´í…Œê³ ë¦¬ ì½”ë“œë¡œ ì¥ì†Œ ê²€ìƒ‰ ìš”ì²­
    ps.categorySearch(categoryCode, categorySearchCB, {
        location: center,
        radius: radius
    });

    // ê²€ìƒ‰ì´ ì™„ë£Œëœ ì§í›„ì— ì§€ë„ ì¤‘ì‹¬ì„ ë‹¤ì‹œ ì„¤ì •í•˜ëŠ” ë”œë ˆì´ ì¶”ê°€
    setTimeout(() => {
        map.setCenter(center);
    }, 10); // 100ms ì§€ì—° í›„ ì§€ë„ ì¤‘ì‹¬ ì¬ì„¤ì •
}

// í‚¤ì›Œë“œë¡œ ì¥ì†Œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤
searchPlaces();

// í‚¤ì›Œë“œ ê²€ìƒ‰ì„ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function searchPlaces() {

    var keyword = document.getElementById('keyword').value;

    if (!keyword.replace(/^\s+|\s+$/g, '')) {
        alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return false;
    }

    // ì¥ì†Œê²€ìƒ‰ ê°ì²´ë¥¼ í†µí•´ í‚¤ì›Œë“œë¡œ ì¥ì†Œê²€ìƒ‰ì„ ìš”ì²­í•©ë‹ˆë‹¤
    ps.keywordSearch( keyword, placesSearchCB); 
}

// ì¥ì†Œê²€ìƒ‰ì´ ì™„ë£Œëì„ ë•Œ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜ ì…ë‹ˆë‹¤
function placesSearchCB(data, status, pagination) {
    if (status === kakao.maps.services.Status.OK) {

        // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
        // ê²€ìƒ‰ ëª©ë¡ê³¼ ë§ˆì»¤ë¥¼ í‘œì¶œí•©ë‹ˆë‹¤
        displayPlaces(data);

        // í˜ì´ì§€ ë²ˆí˜¸ë¥¼ í‘œì¶œí•©ë‹ˆë‹¤
        displayPagination(pagination);

    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {

        alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;

    } else if (status === kakao.maps.services.Status.ERROR) {

        alert('ê²€ìƒ‰ ê²°ê³¼ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        return;

    }
}

// ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡ê³¼ ë§ˆì»¤ë¥¼ í‘œì¶œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function displayPlaces(places) {

    var listEl = document.getElementById('placesList'), 
    menuEl = document.getElementById('menu_wrap'),
    fragment = document.createDocumentFragment(), 
    bounds = new kakao.maps.LatLngBounds(), 
    listStr = '';
    
    // ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡ì— ì¶”ê°€ëœ í•­ëª©ë“¤ì„ ì œê±°í•©ë‹ˆë‹¤
    removeAllChildNods(listEl);

    // ì§€ë„ì— í‘œì‹œë˜ê³  ìˆëŠ” ë§ˆì»¤ë¥¼ ì œê±°í•©ë‹ˆë‹¤
    removeMarker();
    
    for (var i = 0; i < places.length; i++) {
        // ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤
        var placePosition = new kakao.maps.LatLng(places[i].y, places[i].x),
            marker = addMarker(placePosition, i, places[i].place_name, places[i]), // ë³€ê²½ëœ ë¶€ë¶„
            itemEl = getListItem(i, places[i]);

        // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•˜ê¸°ìœ„í•´
        // LatLngBounds ê°ì²´ì— ì¢Œí‘œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
        bounds.extend(placePosition);

        // ë§ˆì»¤ì™€ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì— mouseover í–ˆì„ë•Œ
        // í•´ë‹¹ ì¥ì†Œì— ì¸í¬ìœˆë„ìš°ì— ì¥ì†Œëª…ì„ í‘œì‹œí•©ë‹ˆë‹¤
        // mouseout í–ˆì„ ë•ŒëŠ” ì¸í¬ìœˆë„ìš°ë¥¼ ë‹«ìŠµë‹ˆë‹¤
        (function(marker, title) {
            kakao.maps.event.addListener(marker, 'mouseover', function() {
                displayInfowindow(marker, title);
            });

            kakao.maps.event.addListener(marker, 'mouseout', function() {
                infowindow.close();
            });

            itemEl.onmouseover =  function () {
                displayInfowindow(marker, title);
            };

            itemEl.onmouseout =  function () {
                infowindow.close();
            };
        })(marker, places[i].place_name);

        fragment.appendChild(itemEl);
    }

    // ê²€ìƒ‰ê²°ê³¼ í•­ëª©ë“¤ì„ ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ Elementì— ì¶”ê°€í•©ë‹ˆë‹¤
    listEl.appendChild(fragment);
    menuEl.scrollTop = 0;

    // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤
    map.setBounds(bounds);
}

// ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ Elementë¡œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function getListItem(index, places) {
    var el = document.createElement('li');
    el.className = 'item';

    // ê¸°ë³¸ ì •ë³´ HTML
    var itemStr = `
        <span class="markerbg marker_${index + 1}"></span>
        <div class="info">
            <h5>${places.place_name}</h5>
            ${places.category_name ? `<span class="category">${places.category_name}</span><br>` : ''}
            ${places.road_address_name 
                ? `<span>${places.road_address_name}</span><br><span class="jibun gray">${places.address_name}</span>` 
                : `<span>${places.address_name}</span>`
            }
            <span class="tel">${places.phone || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ'}</span>
        </div>
    `;

    // ë³„ì  í‰ê·  ì„¹ì…˜ ì¶”ê°€ (ì´ˆê¸°ê°’ì€ ë¡œë”© ì¤‘ìœ¼ë¡œ í‘œì‹œ)
    itemStr += `
        <div class="average-rating mt-3">
            <span class="stars">â­â­â­â­â­</span> <!-- ê¸°ë³¸ ë³„ì  ì˜ˆì‹œ -->
            <span class="value">í‰ê·  ë³„ì  ê³„ì‚° ì¤‘...</span> <!-- ê¸°ë³¸ í‰ê· ê°’ -->
        </div>
    `;

    // ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ ì¶”ê°€ (ë¹ˆ ìƒíƒœë¡œ ìƒì„±)
    itemStr += `
        <div class="review-list">
            <p>ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p> <!-- ë¡œë”© ë©”ì‹œì§€ -->
        </div>
    `;

    el.innerHTML = itemStr;

    // ì¥ì†Œ ì´ë¦„ì„ ì´ìš©í•´ ë¦¬ë·°ë¥¼ ë¡œë“œí•˜ê³  ì—…ë°ì´íŠ¸
    loadReviews(places.place_name, el);

    return el;
}


//ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì½œë°± í•¨ìˆ˜
function categorySearchCB(data, status, pagination) {
    if (status === kakao.maps.services.Status.OK) {
        // ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë§ˆì»¤ì™€ ê²°ê³¼ë¥¼ í‘œì‹œ
        console.log("ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ ê²°ê³¼:", data);

        // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
        removeMarker();

        // ì§€ë„ì— í‘œì‹œí•  ìƒˆë¡œìš´ ë§ˆì»¤ ì¶”ê°€
        data.forEach((place, idx) => {
            const position = new kakao.maps.LatLng(place.y, place.x);
            addCategoryMarker(position, idx, place.place_name, place);
        });

        // í˜ì´ì§€ ë²ˆí˜¸ í‘œì‹œ (ì˜µì…˜ìœ¼ë¡œ ì¶”ê°€ ê°€ëŠ¥)
        if (pagination) {
            displayPagination(pagination);
        }
    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
        alert('ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
    } else if (status === kakao.maps.services.Status.ERROR) {
        alert('ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}


function addCategoryMarker(position, idx, title, place) {
    var imageSrc;

    // ì¹´í…Œê³ ë¦¬ ë¶„ë¦¬
    var categories = place.category_name.split(' > ');
    var topCategory = categories[0];

    // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë‹¤ë¥¸ ì´ë¯¸ì§€ íŒŒì¼ì„ ì„¤ì •
    if (place.category_name.includes('ì¹´í˜')) {
        imageSrc = 'https://i.ibb.co/7WYRffx/2.png';
    } else if (topCategory === 'ìŒì‹ì ') {
        imageSrc = 'https://i.ibb.co/KVfTjZ3/1.png';
    } else if (place.category_name.includes('ì€í–‰')) {
        imageSrc = 'https://i.ibb.co/QXw7w9s/6.png';
    } else if (place.category_name.includes('ì•½êµ­')) {
        imageSrc = 'https://i.ibb.co/LzqYJc2/4.png';
    } else if (place.category_name.includes('ì£¼ìœ ì†Œ')) {
        imageSrc = 'https://i.ibb.co/dD0NB2J/3.png';
    } else if (place.category_name.includes('í¸ì˜ì ')) {
        imageSrc = 'https://i.ibb.co/pPCth4L/9.png';
    } else if (place.category_name.includes('ëŒ€í˜•ë§ˆíŠ¸') || place.category_name.includes('ìŠˆí¼ë§ˆì¼“')) {
        imageSrc = 'https://i.ibb.co/yp4crvZ/8.png';
    } else if (place.category_name.includes('íŒ¨ì…˜')) {
        imageSrc = 'https://i.ibb.co/3YnxZyk/7.png';
    } else {
        imageSrc = 'https://i.pinimg.com/564x/86/89/4b/86894b48abbc5bd42b5f317be9b52934.jpg';
    }

    var imageSize = new kakao.maps.Size(34, 45),
        markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize),
        marker = new kakao.maps.Marker({
            position: position,
            image: markerImage
        });

    marker.setMap(map);
    markers.push(marker);
 // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    kakao.maps.event.addListener(marker, 'click', function () {
    	// ê¸°ì¡´ overlay ë‹«ê¸°
        if (currentOverlay) {
            currentOverlay.setMap(null);
        }
        var latitude = position.getLat();
        var longitude = position.getLng();
        
     // ë§ˆì»¤ ìƒ‰ìƒ ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸
        const markerColorImages = {
            red: 'https://i.ibb.co/JKQhd5F/red.png',
            orange: 'https://i.ibb.co/5GBR3by/orange.png',
            yellow: 'https://i.ibb.co/M26n9tG/yellow.png',
            green: 'https://i.ibb.co/hfBPHYB/green.png',
            blue: 'https://i.ibb.co/6N7BwZ6/blue.png',
        };

        // ë§ˆì»¤ ì„ íƒ UI ìƒì„±
        let markerSelectionUI = '<div style="display: flex; gap: 30px; justify-content: center; margin-top: 10px;">';
        for (const [color, url] of Object.entries(markerColorImages)) {
            markerSelectionUI += `
                <img src="${url}" alt="${color}" 
                    style="width: 30px; height: 50px; cursor: pointer;" 
                    data-color="${color}"
                    onclick="document.getElementById('selected-marker-color').value='${color}'; document.getElementById('color-feedback').textContent='í˜„ì¬ ì„ íƒëœ ìƒ‰ìƒ: ${color}';">
            `;
        }
        markerSelectionUI += '</div>';

        // ì˜¤ë²„ë ˆì´ ë‚´ìš©ì„ êµ¬ì„±í•©ë‹ˆë‹¤
        var overlayContent = '<div class="wrap">' +
            '    <div class="info">' +
            '        <div class="title">' + title +
            '            <div class="close" onclick="closeOverlay()"></div>' +
            '        </div>' +
            '        <div class="body">' +
            '            <div class="desc">' +
            '                <span>' + (place.road_address_name ? 'ì£¼ì†Œ: ' + place.road_address_name : place.address_name) + '</span><br>' +
            '                <span class="tel">' + (place.phone ? 'ì „í™”: ' + place.phone : '') + '</span><br>' +
            '                <span class="category">' + 'ì¹´í…Œê³ ë¦¬: ' + (place.category_name ? place.category_name : '') + '</span><br>' +
            '                <span>ìœ„ë„: ' + latitude + '</span><br>' +
            '                <span>ê²½ë„: ' + longitude + '</span><br>' +
            '                <input type="text" placeholder="ì €ì¥í•  ë³„ì¹­" id="alias" class="input"><br>' +
            '                <input type="text" placeholder="ë©”ëª¨" id="note" class="input"><br>' +
            '                <label>ë§ˆì»¤ ìƒ‰ìƒ ì„ íƒ:</label>' +
            '                <input type="hidden" id="selected-marker-color" value="red">' + // ê¸°ë³¸ê°’ì€ ë¹¨ê°•
            markerSelectionUI +
            '<p id="color-feedback" style="margin-top: 10px; font-weight: bold; color: #333;">í˜„ì¬ ì„ íƒëœ ìƒ‰ìƒ: ë¹¨ê°•</p>' +
            '                <select id="mapType">' +
            '                    <option value="MY_MAP">ë‚˜ë§Œì˜ ì§€ë„</option>' +
            '                    <option value="GROUP1_MAP">ê·¸ë£¹1 ì§€ë„</option>' +
            '                    <option value="GROUP2_MAP">ê·¸ë£¹2 ì§€ë„</option>' +
            '                </select><br>' +
            '                <button onclick="saveLocation(\'' + title + '\', ' + latitude + ', ' + longitude + ', \'' + (place.address_name || '') + '\', \'' + (place.road_address_name || '') + '\', \'' + (place.phone || '') + '\', \'' + (place.category_name || '') + '\')">ì €ì¥</button>' +
            '            </div>' +
            '        </div>' +
            '    </div>' +
            '</div>';

     // ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ë¥¼ ìƒì„±í•˜ê³  í‘œì‹œí•©ë‹ˆë‹¤
        currentOverlay = new kakao.maps.CustomOverlay({
            position: position,
            content: overlayContent,
            xAnchor: 0.5,
            yAnchor: 1
        });

        currentOverlay.setMap(map);
    });
}

function addMarker(position, idx, title, place) {
    var markerImage = new kakao.maps.MarkerImage(
        'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png',
        new kakao.maps.Size(36, 37),
        { spriteSize: new kakao.maps.Size(36, 691), spriteOrigin: new kakao.maps.Point(0, idx * 46 + 10), offset: new kakao.maps.Point(13, 37) }
    );

    var marker = new kakao.maps.Marker({
        position: position,
        image: markerImage
    });
    marker.setMap(map);
    markers.push(marker);
// ê°€ì…ëœ ê·¸ë£¹ ëª©ë¡ì„ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
async function fetchUserGroups() {
    try {
        const response = await fetch('/user/groups');
        if (response.ok) {
            return await response.json();
        } else {
            console.error("Failed to fetch user groups.");
            return [];
        }
    } catch (error) {
        console.error("Error fetching user groups:", error);
        return [];
    }
}

kakao.maps.event.addListener(marker, 'click', async function () {
	// ê¸°ì¡´ overlay ë‹«ê¸°
    if (currentOverlay) {
        currentOverlay.setMap(null);
    }
    console.log("Marker clicked:", title); // ë””ë²„ê¹…ìš©
    var latitude = position.getLat();
    var longitude = position.getLng();

    var userPermission = parseInt(document.body.getAttribute("data-user-permission"), 10);
    console.log("User Permission (converted):", userPermission); // ë””ë²„ê¹…ìš©

    // ë§ˆì»¤ ìƒ‰ìƒ ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸
    const markerColorImages = {
        red: 'https://i.ibb.co/JKQhd5F/red.png',
        orange: 'https://i.ibb.co/5GBR3by/orange.png',
        yellow: 'https://i.ibb.co/M26n9tG/yellow.png',
        green: 'https://i.ibb.co/hfBPHYB/green.png',
        blue: 'https://i.ibb.co/6N7BwZ6/blue.png',
    };

    // ë§ˆì»¤ ì„ íƒ UI ìƒì„±
    let markerSelectionUI = '<div style="display: flex; gap: 30px; justify-content: center; margin-top: 10px;">';
    for (const [color, url] of Object.entries(markerColorImages)) {
        markerSelectionUI += `
            <img src="${url}" alt="${color}" 
                style="width: 30px; height: 50px; cursor: pointer;" 
                data-color="${color}"
                onclick="document.getElementById('selected-marker-color').value='${color}'; document.getElementById('color-feedback').textContent='í˜„ì¬ ì„ íƒëœ ìƒ‰ìƒ: ${color}';">
        `;
    }
    markerSelectionUI += '</div>';

    // ì˜¤ë²„ë ˆì´ ë‚´ìš© ìƒì„±
    var overlayContent =
    '<div class="wrap">' +
    '    <div class="info">' +
    '        <div class="title">' + title +
    '            <div class="close" onclick="closeOverlay()"></div>' +
    '        </div>' +
    '        <div class="body">' +
    '            <div class="desc">' +
    '                <div class="average-rating">í‰ê·  ë³„ì : ' +
    '                    <div id="average-stars" class="rating-stars" style="display: inline-flex; gap: 5px;"></div>' +
    '                    <span id="average-rating" style="margin-left: 5px;">ë¡œë”© ì¤‘...</span>' +
    '                </div>' +
    '                <span>' + (place.road_address_name ? 'ì£¼ì†Œ: ' + place.road_address_name : place.address_name) + '</span><br>' +
    '                <span class="tel">' + (place.phone ? 'ì „í™”: ' + place.phone : 'ì „í™”ë²ˆí˜¸ ì—†ìŒ') + '</span><br>' +
    '                <span class="category">' + 'ì¹´í…Œê³ ë¦¬: ' + (place.category_name ? place.category_name : 'ì¹´í…Œê³ ë¦¬ ì •ë³´ ì—†ìŒ') + '</span><br>' +
    '                <span>ìœ„ë„: ' + latitude + '</span><br>' +
    '                <span>ê²½ë„: ' + longitude + '</span><br>' +
    '                <input type="text" placeholder="ì €ì¥í•  ë³„ì¹­" id="alias" class="input"><br>' +
    '                <input type="text" placeholder="ë©”ëª¨" id="note" class="input"><br>' +
    '                <label>ë§ˆì»¤ ìƒ‰ìƒ ì„ íƒ:</label>' +
    '                <input type="hidden" id="selected-marker-color" value="red">' + // ê¸°ë³¸ê°’ì€ ë¹¨ê°•
    markerSelectionUI +
    '<p id="color-feedback" style="margin-top: 10px; font-weight: bold; color: #333;">í˜„ì¬ ì„ íƒëœ ìƒ‰ìƒ: ë¹¨ê°•</p>'

    if (userPermission === 0) {
        console.log("ê´€ë¦¬ì ê¶Œí•œ: topic í•„ë“œ ì¶”ê°€"); // ë””ë²„ê¹…ìš©
        overlayContent += '<input type="text" id="topic" placeholder="ì£¼ì œ ì…ë ¥" class="input"><br>';
    } else {
        console.log("ì¼ë°˜ ì‚¬ìš©ì ê¶Œí•œ: ê·¸ë£¹ ëª©ë¡ í•„ë“œ ì¶”ê°€"); // ë””ë²„ê¹…ìš©
        const groups = await fetchUserGroups(); // ê°€ì…ëœ ê·¸ë£¹ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        overlayContent += '<select id="mapType">';
        overlayContent += '<option value="MY_MAP">ë‚˜ë§Œì˜ ì§€ë„</option>';
        groups.forEach(group => {
            overlayContent += `<option value="${group.groupId}"> ê·¸ë£¹ëª…:${group.groupName}</option>`;
        });
        overlayContent += '</select><br>';
    }

    overlayContent += '<button onclick="saveLocation(\'' + title + '\', ' + latitude + ', ' + longitude + ', \'' + (place.address_name || '') + '\', \'' + (place.road_address_name || '') + '\', \'' + (place.phone || '') + '\', \'' + (place.category_name || '') + '\')">ì €ì¥</button>' +
        '            </div>' +
        '        </div>' +
        '    </div>' +
        '</div>';

    // ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ë¥¼ ìƒì„±í•˜ê³  í‘œì‹œí•©ë‹ˆë‹¤
    currentOverlay = new kakao.maps.CustomOverlay({
        position: position,
        content: overlayContent,
        xAnchor: 0.5,
        yAnchor: 1
    });

    currentOverlay.setMap(map);
    fetchAverageRating(title);
});

    return marker;
}

//ì˜¤ë²„ë ˆì´ë¥¼ ë‹«ëŠ” í•¨ìˆ˜
function closeOverlay() {
    if (currentOverlay) {
        currentOverlay.setMap(null); // ê¸°ì¡´ ì˜¤ë²„ë ˆì´ ë‹«ê¸°
        currentOverlay = null; // ì¶”ì  ë³€ìˆ˜ ì´ˆê¸°í™”
    }
}


// ì§€ë„ ìœ„ì— í‘œì‹œë˜ê³  ìˆëŠ” ë§ˆì»¤ë¥¼ ëª¨ë‘ ì œê±°í•©ë‹ˆë‹¤
function removeMarker() {
    // ì§€ë„ì—ì„œ ëª¨ë“  ë§ˆì»¤ ì œê±°
    for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(null);
    }
    markers = []; // ë§ˆì»¤ ë°°ì—´ ì´ˆê¸°í™”

    // ì§€ë„ì—ì„œ ëª¨ë“  ì˜¤ë²„ë ˆì´ ì œê±°
    currentOverlays.forEach(function (overlay) {
        overlay.setMap(null);
    });
    currentOverlays = []; // ì˜¤ë²„ë ˆì´ ë°°ì—´ ì´ˆê¸°í™”

    // í˜„ì¬ ì˜¤ë²„ë ˆì´ë„ ë‹«ê¸°
    if (window.currentOverlay) {
        window.currentOverlay.setMap(null);
        window.currentOverlay = null;
    }
}


// ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ í•˜ë‹¨ì— í˜ì´ì§€ë²ˆí˜¸ë¥¼ í‘œì‹œëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function displayPagination(pagination) {
    var paginationEl = document.getElementById('pagination'),
        fragment = document.createDocumentFragment(),
        i; 

    // ê¸°ì¡´ì— ì¶”ê°€ëœ í˜ì´ì§€ë²ˆí˜¸ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤
    while (paginationEl.hasChildNodes()) {
        paginationEl.removeChild (paginationEl.lastChild);
    }

    for (i=1; i<=pagination.last; i++) {
        var el = document.createElement('a');
        el.href = "#";
        el.innerHTML = i;

        if (i===pagination.current) {
            el.className = 'on';
        } else {
            el.onclick = (function(i) {
                return function() {
                    pagination.gotoPage(i);
                }
            })(i);
        }

        fragment.appendChild(el);
    }
    paginationEl.appendChild(fragment);
}

// ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ ë˜ëŠ” ë§ˆì»¤ë¥¼ í´ë¦­í–ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
// ì¸í¬ìœˆë„ìš°ì— ì¥ì†Œëª…ì„ í‘œì‹œí•©ë‹ˆë‹¤
function displayInfowindow(marker, title) {
    var content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

    // ê¸°ì¡´ infowindow ë‹«ê¸°
    if (currentInfowindow) {
        currentInfowindow.close();
    }

    infowindow.setContent(content);
    infowindow.open(map, marker);

    // í˜„ì¬ infowindowë¥¼ ì¶”ì 
    currentInfowindow = infowindow;
}

 // ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ì˜ ìì‹ Elementë¥¼ ì œê±°í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
function removeAllChildNods(el) {   
    while (el.hasChildNodes()) {
        el.removeChild (el.lastChild);
    }
}
 
//ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ë¥¼ ì •ì˜í•˜ëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤
function CustomOverlay(position, content) {
    this.position = position;
    this.content = content;
    this.overlay = new kakao.maps.CustomOverlay({
        position: this.position,
        content: this.content,
        xAnchor: 0.5,
        yAnchor: 1,
    });
}

// ì˜¤ë²„ë ˆì´ë¥¼ ë³´ì—¬ì£¼ëŠ” ë©”ì„œë“œ
CustomOverlay.prototype.setMap = function(map) {
    this.overlay.setMap(map);
};

// ì˜¤ë²„ë ˆì´ë¥¼ ìˆ¨ê¸°ëŠ” ë©”ì„œë“œ
CustomOverlay.prototype.setVisible = function(visible) {
    this.overlay.setMap(visible ? map : null);
};

async function sendMessage(event) {
    if (event.key === 'Enter') {
      const userInput = document.getElementById('user-input').value;
      if (userInput.trim() === '') return;

      const messagesContainer = document.getElementById('messages');
      
      // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
      const userMessage = document.createElement('div');
      userMessage.textContent = 'You: ' + userInput;
      messagesContainer.appendChild(userMessage);

      // ì…ë ¥ ì°½ ë¹„ìš°ê¸°
      document.getElementById('user-input').value = '';

      // ì„œë²„ë¡œ ìš”ì²­ ì „ì†¡
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ message: userInput })
      });

      const data = await response.json();
      const gptMessage = data.response;

      // GPT ì‘ë‹µ ì¶”ê°€
      const gptResponse = document.createElement('div');
      gptResponse.textContent = 'GPT: ' + gptMessage;
      messagesContainer.appendChild(gptResponse);

      // ìë™ ìŠ¤í¬ë¡¤
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
  }

//ì¥ì†Œ ì €ì¥ í•¨ìˆ˜ ìˆ˜ì •
function saveLocation(title, latitude, longitude, address_name, road_address_name, phone, category_name) {
    const alias = document.getElementById("alias") ? document.getElementById("alias").value : "";
    const note = document.getElementById("note") ? document.getElementById("note").value : "";
    const markerColor = document.getElementById("selected-marker-color").value; // ì—¬ê¸°ì„œ nullë¡œ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸

    console.log("Marker Color to be saved:", markerColor); // ë””ë²„ê¹…ìš©

    const userPermission = parseInt(document.body.getAttribute("data-user-permission"), 10);

    let topic = null;
    let mapType = null;

    if (userPermission === 0) {
        topic = document.getElementById("topic") ? document.getElementById("topic").value : "";
    } else {
        mapType = document.getElementById("mapType") ? document.getElementById("mapType").value : "MY_MAP";
    }

    const requestData = {
        category: category_name || '',
        locationName: title,
        locationAlias: alias,
        locationDesc: note,
        latitude: latitude,
        longitude: longitude,
        address: road_address_name || address_name,
        phone: phone || '',
        topic: topic,
        groupId: mapType !== "MY_MAP" ? parseInt(mapType, 10) : null,
        markerColor: markerColor // nullì´ ì•„ë‹Œ ê°’ì„ ì „ë‹¬
    };

    console.log("Request Data:", requestData); // ë””ë²„ê¹…ìš©

    const url = mapType === "MY_MAP" ? '/saveMyMapPoint' : '/saveGroupMapPoint';

    fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestData)
    })
        .then(response => response.json())
        .then(data => {
            alert(data.message || data.error);
            closeOverlay();
        })
        .catch(error => {
            console.error('Error:', error);
            alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
}



//í˜ì´ì§€ê°€ ë¡œë“œëœ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
document.addEventListener("DOMContentLoaded", function () {
    // ëª¨ë“  ì¥ì†Œ ë§í¬ì— í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
    const locationLinks = document.querySelectorAll(".location-link");
    locationLinks.forEach(link => {
        link.addEventListener("click", function () {
            // data-* ì†ì„±ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const latitude = parseFloat(this.dataset.lat);
            const longitude = parseFloat(this.dataset.lng);
            const locationName = this.dataset.name;

            // ë§ˆì»¤ í‘œì‹œ í•¨ìˆ˜ í˜¸ì¶œ
            showMarker(latitude, longitude, locationName);
        });
    });
});

document.addEventListener("DOMContentLoaded", function () {
    const topicFilter = document.getElementById("topicFilter");
    const placeList = document.getElementById("place-list");

    // ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    topicFilter.addEventListener("change", function () {
        const selectedTopic = topicFilter.value;

        // ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ì˜ ê° í•­ëª©ì„ í™•ì¸
        const places = placeList.querySelectorAll(".col"); // `.col` ìš”ì†Œë¡œ ì„ íƒ
        places.forEach(place => {
            const placeTopic = place.getAttribute("data-topic-th"); // `data-topic-th` ì†ì„± ì½ê¸°

            // ì „ì²´ ë³´ê¸°(ALL) ë˜ëŠ” ì£¼ì œê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ì—ë§Œ í‘œì‹œ
            if (selectedTopic === "ALL" || placeTopic === selectedTopic) {
                place.style.display = "block"; // ë³´ì´ê¸°
            } else {
                place.style.display = "none"; // ìˆ¨ê¸°ê¸°
            }
        });
    });
});




function showMarker(latitude, longitude, locationName) {
    // ê¸°ì¡´ ë§ˆì»¤ì™€ ì˜¤ë²„ë ˆì´ ì œê±°
    removeMarkersAndOverlays();

    // ë§ˆì»¤ ìœ„ì¹˜ ìƒì„±
    var position = new kakao.maps.LatLng(latitude, longitude);

    // ìƒˆë¡œìš´ ë§ˆì»¤ ìƒì„±
    var marker = new kakao.maps.Marker({
        position: position
    });

    // ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ
    marker.setMap(map);
    currentMarkers.push(marker);

    // ì§€ë„ ì¤‘ì‹¬ì„ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™
    map.setCenter(position);

    // ì¸í¬ìœˆë„ìš° ìƒì„± ë° í‘œì‹œ
    var content = '<div style="padding:5px;z-index:1;">' + locationName + '</div>';
    infowindow.setContent(content);
    infowindow.open(map, marker);
    currentInfowindow = infowindow; // í˜„ì¬ infowindow ì¶”ì 

    // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
    kakao.maps.event.addListener(marker, 'click', function () {
        console.log("Marker clicked:", { latitude, longitude, locationName });

        // overlayDataì—ì„œ í´ë¦­ëœ ë§ˆì»¤ì˜ ë°ì´í„°ë¥¼ ì°¾ìŒ
        const data = findOverlayDataByName(locationName);

        if (!data) {
            console.error("No data found for the clicked marker.");
            return;
        }

        // ì €ì¥ìš© ì˜¤ë²„ë ˆì´ ìƒì„±
        const saveOverlay = createSaveOverlay(data);

        // ê¸°ì¡´ infowindow ë‹«ê¸°
        infowindow.close();

        // ì €ì¥ìš© ì˜¤ë²„ë ˆì´ ì§€ë„ì— í‘œì‹œ
        saveOverlay.setMap(map);
        window.currentOverlay = saveOverlay; // í™œì„± ì˜¤ë²„ë ˆì´ ì¶”ì 
    });
}

// ë°ì´í„° ê²€ìƒ‰ í•¨ìˆ˜
function findOverlayDataByName(name) {
    // overlayDataì—ì„œ ì´ë¦„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê²€ìƒ‰
    for (const category in overlayData) {
        const items = overlayData[category];
        const match = items.find(item => item.name === name);
        if (match) return match; // í•´ë‹¹ ë°ì´í„° ë°˜í™˜
    }
    return null; // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ null ë°˜í™˜
}



// ê¸°ì¡´ ë§ˆì»¤ë¥¼ ëª¨ë‘ ì œê±°í•˜ëŠ” í•¨ìˆ˜
function removeMarker() {
    markers.forEach(function (marker) {
        marker.setMap(null); // ì§€ë„ì—ì„œ ë§ˆì»¤ ì œê±°
    });
    markers = []; // ë§ˆì»¤ ë°°ì—´ ì´ˆê¸°í™”
}


//ì£¼ì œì— ë”°ë¥¸ ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ ë°ì´í„°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤
var overlayData = {
    "ë°ì´íŠ¸ ë§›ì§‘ ì¶”ì²œ": [
        {
            position: new kakao.maps.LatLng(37.400789535230956, 126.91795222023141),
            name: "ì–¼ë£©ë§ì‹ë‹¹",
            image: "https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20230725_31%2F1690231419104OgSJL_JPEG%2F146A8BA9-A99E-4C0F-8B6A-F0F61222FAFB.jpeg",
            address: "ê²½ê¸° ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬ ì•ˆì–‘ë¡œ329ë²ˆê¸¸ 23",
            phone: "031-443-0783",
            category: "ìŒì‹ì  > í•œì‹"
        },
        {
            position: new kakao.maps.LatLng(37.3937549617236, 126.961593701651),
            name: "ì—”ìš°",
            image: "https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20231023_110%2F1698058451464WVLXo_JPEG%2FKakaoTalk_20230711_185038597_12.jpg",
            address: "ê²½ê¸° ì•ˆì–‘ì‹œ ë™ì•ˆêµ¬ ê´€í‰ë¡œ182ë²ˆê¸¸ 23",
            phone: "010-7181-7385",
            category: "ìŒì‹ì  > ìˆ ì§‘ > ì¼ë³¸ì‹ì£¼ì "
        },
        {
            position: new kakao.maps.LatLng(37.3923379453819, 126.95719589159),
            name: "ì‚°íƒ€ë£¨ì¹˜ì•„",
            image: "https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20231027_97%2F1698381447243XGXRJ_JPEG%2FKakaoTalk_20231026_222157546_26.jpg",
            address: "ê²½ê¸° ì•ˆì–‘ì‹œ ë™ì•ˆêµ¬ ì‹œë¯¼ëŒ€ë¡œ 230",
            phone: "031-444-7000",
            category: "ìŒì‹ì  > ì–‘ì‹ > ì´íƒˆë¦¬ì•ˆ"
        },
        {
            position: new kakao.maps.LatLng(37.4002025514072, 126.91864969660887),
            name: "ìš°í™”",
            image: "https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20220417_113%2F1650205159350SIXEL_JPEG%2FIMG_20220412_193221_941.jpg",
            address: "ê²½ê¸° ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬ ì–‘í™”ë¡œ72ë²ˆê¸¸ 83-21",
            phone: "010-4376-4260",
            category: "ìŒì‹ì  > ìˆ ì§‘ > í˜¸í”„,ìš”ë¦¬ì£¼ì "
        },
        {
            position: new kakao.maps.LatLng(37.4009378966552, 126.91496703958032),
            name: "ë°±ì–µí•œìš°ì‹ë‹¹",
            image: "https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20190709_197%2F1562634758740sS53p_JPEG%2FD0VdgUgirT5MWOHvIgjRQAqi.JPG.jpg",
            address: "ê²½ê¸° ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬ ë°•ë‹¬ë¡œ560ë²ˆê¸¸ 35",
            phone: "031-447-1252",
            category: "ìŒì‹ì  > í•œì‹ > ìœ¡ë¥˜,ê³ ê¸°"
        }
    ],
    "ë¶„ìœ„ê¸° ì¢‹ì€ ì¹´í˜ ì¶”ì²œ": [
        {
            position: new kakao.maps.LatLng(37.400036098996196, 126.9216687415007),
            name: "ì†Œì‚¬ì´ì–´í‹°ì¹´í˜",
            image: "https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20221222_21%2F16716350961528cMzP_JPEG%2FIMG_1694.JPG",
            address: "ê²½ê¸° ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬ ì¥ë‚´ë¡œ139ë²ˆê¸¸ 56-6",
            phone: "031-464-9901",
            category: "ìŒì‹ì  > ì¹´í˜ > ì»¤í”¼ì „ë¬¸ì "
        },
        {
            position: new kakao.maps.LatLng(37.394518453298, 126.921987302323),
            name: "ì‹œì•„ì¼€ì´í¬",
            image: "https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20211115_171%2F1636949178361Lwbby_JPEG%2FKakaoTalk_20211115_130503069_04.jpg",
            address: "ê²½ê¸° ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬ ëƒ‰ì²œë¡œ 158",
            phone: "031-443-0512",
            category: "ìŒì‹ì  > ì¹´í˜ > í…Œë§ˆì¹´í˜ > ë””ì €íŠ¸ì¹´í˜"
        },
        {
            position: new kakao.maps.LatLng(37.3996811596529, 126.919086203476),
            name: "ìŠ¤íƒœê·¸ì»¤í”¼",
            image: "https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20231128_51%2F1701138594719Tctjq_JPEG%2FIMG_4315.jpeg",
            address: "ê²½ê¸° ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬ ì•ˆì–‘ë¡œ319ë²ˆê¸¸ 22",
            phone: "010-9253-8714",
            category: "ìŒì‹ì  > ì¹´í˜ > ì»¤í”¼ì „ë¬¸ì "
        }
    ]
};
//í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ë§ˆì»¤ ë° ì˜¤ë²„ë ˆì´ ë°°ì—´
var currentMarkers = [];
var currentOverlays = [];

// ì„ íƒëœ ì£¼ì œì— ë”°ë¼ ë§ˆì»¤ì™€ ì˜¤ë²„ë ˆì´ë¥¼ ë™ì‹œì— í‘œì‹œí•©ë‹ˆë‹¤
// ì„ íƒëœ ì£¼ì œì— ë”°ë¼ ë§ˆì»¤ì™€ ì˜¤ë²„ë ˆì´ë¥¼ ë™ì‹œì— í‘œì‹œí•©ë‹ˆë‹¤
document.getElementById('topicFilter').addEventListener('change', function () {
    var selectedTopic = this.value;

    // ê¸°ì¡´ ë§ˆì»¤ì™€ ì˜¤ë²„ë ˆì´ ì œê±°
    removeMarkersAndOverlays();

    if (selectedTopic === "NONE") {
        // "ì—†ìŒ"ì´ ì„ íƒëœ ê²½ìš° ì•„ë¬´ê²ƒë„ í‘œì‹œí•˜ì§€ ì•ŠìŒ
        return;
    }

    if (selectedTopic === "ALL") {
        // "ì „ì²´(ALL)"ì´ ì„ íƒëœ ê²½ìš° ëª¨ë“  ì£¼ì œì˜ ì¥ì†Œë¥¼ í‘œì‹œ
        Object.keys(overlayData).forEach(function (topic) {
            overlayData[topic].forEach(function (location) {
                createMarkerAndOverlay(location);
            });
        });
    } else if (overlayData[selectedTopic]) {
        // íŠ¹ì • ì£¼ì œê°€ ì„ íƒëœ ê²½ìš° í•´ë‹¹ ì£¼ì œì˜ ì¥ì†Œë¥¼ í‘œì‹œ
        overlayData[selectedTopic].forEach(function (location) {
            createMarkerAndOverlay(location);
        });

        // ì§€ë„ ì¤‘ì‹¬ì„ ì²« ë²ˆì§¸ ì¥ì†Œë¡œ ì„¤ì •
        if (overlayData[selectedTopic].length > 0) {
            map.setCenter(overlayData[selectedTopic][0].position);
        }
    }
});

function createMarkerAndOverlay(data) {
    // ë§ˆì»¤ ìƒì„±
    var marker = new kakao.maps.Marker({
        position: data.position
    });

    // ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ
    marker.setMap(map);
    currentMarkers.push(marker); // ë§ˆì»¤ ë°°ì—´ì— ì¶”ê°€

    // ê¸°ë³¸ ì˜¤ë²„ë ˆì´ ì½˜í…ì¸  ìƒì„±
    var overlayContent = `
        <div class="overlaybox" style="padding: 10px; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <div style="display: flex; align-items: center;">
                <img src="${data.image}" alt="${data.name}" style="width: 40px; height: 40px; border-radius: 4px; margin-right: 10px;">
                <span>${data.name}</span>
            </div>
        </div>
    `;

    // ê¸°ë³¸ ì˜¤ë²„ë ˆì´ ìƒì„±
    var overlay = new kakao.maps.CustomOverlay({
        position: data.position,
        content: overlayContent,
        xAnchor: 0.5,
        yAnchor: 1.1,
        zIndex: 3
    });

    overlay.setMap(map);
    currentOverlays.push(overlay); // ì˜¤ë²„ë ˆì´ ë°°ì—´ì— ì¶”ê°€

    // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    kakao.maps.event.addListener(marker, 'click', function () {
        // ê¸°ì¡´ ì˜¤ë²„ë ˆì´ ë‹«ê¸°
        if (currentOverlay) {
            currentOverlay.setMap(null);
        }

        // ì €ì¥ìš© ì˜¤ë²„ë ˆì´ ìƒì„± ë° í‘œì‹œ
        currentOverlay = createSaveOverlay(data);
        currentOverlay.setMap(map);
    });
}

// ì €ì¥ìš© ì˜¤ë²„ë ˆì´ ìƒì„± í•¨ìˆ˜
function createSaveOverlay(data) {
	console.log("Clicked Marker Data:", data);
    var latitude = data.position.getLat();
    var longitude = data.position.getLng();
    var address = data.address || "ì£¼ì†Œ ì •ë³´ ì—†ìŒ";
    var phone = data.phone || "ì „í™”ë²ˆí˜¸ ì—†ìŒ";
    var category = data.category || "ì¹´í…Œê³ ë¦¬ ì •ë³´ ì—†ìŒ";


    // ë§ˆì»¤ ìƒ‰ìƒ ì„ íƒ UI ìƒì„±
    const markerColorImages = {
        red: 'https://i.ibb.co/JKQhd5F/red.png',
        orange: 'https://i.ibb.co/5GBR3by/orange.png',
        yellow: 'https://i.ibb.co/M26n9tG/yellow.png',
        green: 'https://i.ibb.co/hfBPHYB/green.png',
        blue: 'https://i.ibb.co/6N7BwZ6/blue.png',
    };

    let markerSelectionUI = '<div style="display: flex; gap: 30px; justify-content: center; margin-top: 10px;">';
    for (const [color, url] of Object.entries(markerColorImages)) {
        markerSelectionUI += `
            <img src="${url}" alt="${color}" 
                style="width: 30px; height: 50px; cursor: pointer;" 
                data-color="${color}"
                onclick="document.getElementById('selected-marker-color').value='${color}'; document.getElementById('color-feedback').textContent='í˜„ì¬ ì„ íƒëœ ìƒ‰ìƒ: ${color}';">
        `;
    }
    markerSelectionUI += '</div>';

    // ì˜¤ë²„ë ˆì´ ë‚´ìš© êµ¬ì„±
    var overlayContent = `
        <div class="wrap">
            <div class="info">
                <div class="title" style="display: flex; justify-content: space-between; align-items: center;">
                    ${data.name}
                    <div class="close" onclick="closeOverlay()" style="cursor: pointer;">X</div>
                </div>
                <div class="body">
                    <div class="desc">
                        <span>ì£¼ì†Œ: ${address}</span><br>
                        <span>ì „í™”: ${phone}</span><br>
                        <span>ì¹´í…Œê³ ë¦¬: ${category}</span><br>
                        <span>ìœ„ë„: ${latitude}</span><br>
                        <span>ê²½ë„: ${longitude}</span><br>
                        <input type="text" placeholder="ì €ì¥í•  ë³„ì¹­" id="alias" class="input"><br>
                        <input type="text" placeholder="ë©”ëª¨" id="note" class="input"><br>
                        <label>ë§ˆì»¤ ìƒ‰ìƒ ì„ íƒ:</label>
                        <input type="hidden" id="selected-marker-color" value="red"> ${markerSelectionUI}
                        <p id="color-feedback" style="margin-top: 10px; font-weight: bold; color: #333;">í˜„ì¬ ì„ íƒëœ ìƒ‰ìƒ: ë¹¨ê°•</p>
                        <button onclick="saveLocation('${data.name}', ${latitude}, ${longitude}, '${data.address_name}', '${data.road_address_name}', '${data.phone}', '${data.category_name}')">
                            ì €ì¥
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;

    return new kakao.maps.CustomOverlay({
        position: data.position,
        content: overlayContent,
        xAnchor: 0.5,
        yAnchor: 0.2,
        zIndex: 4
    });
}


//ì˜¤ë²„ë ˆì´ë¥¼ ë‹«ëŠ” í•¨ìˆ˜
function closeOverlay() {
    if (window.currentOverlay) {
        window.currentOverlay.setMap(null); // ì €ì¥ìš© ì˜¤ë²„ë ˆì´ ì§€ë„ì—ì„œ ì œê±°
        window.currentOverlay = null;
    }

    // ëª¨ë“  í˜„ì¬ ì˜¤ë²„ë ˆì´ ë‹«ê¸°
    currentOverlays.forEach(function (overlay) {
        overlay.setMap(null);
    });
    currentOverlays = [];
}

function removeMarkersAndOverlays() {
    // ëª¨ë“  ë§ˆì»¤ ì œê±°
    if (currentMarkers.length > 0) {
        currentMarkers.forEach(function (marker) {
            marker.setMap(null); // ì§€ë„ì—ì„œ ë§ˆì»¤ ì œê±°
        });
        currentMarkers = []; // ë§ˆì»¤ ë°°ì—´ ì´ˆê¸°í™”
    }

    // ëª¨ë“  ì˜¤ë²„ë ˆì´ ì œê±°
    if (currentOverlays.length > 0) {
        currentOverlays.forEach(function (overlay) {
            overlay.setMap(null); // ì§€ë„ì—ì„œ ì˜¤ë²„ë ˆì´ ì œê±°
        });
        currentOverlays = []; // ì˜¤ë²„ë ˆì´ ë°°ì—´ ì´ˆê¸°í™”
    }

    // í˜„ì¬ í™œì„± ì˜¤ë²„ë ˆì´ ì œê±°
    if (window.currentOverlay) {
        window.currentOverlay.setMap(null);
        window.currentOverlay = null;
    }

    // í˜„ì¬ í™œì„± infowindow ë‹«ê¸°
    if (currentInfowindow) {
        currentInfowindow.close();
        currentInfowindow = null;
    }
}

document.addEventListener("DOMContentLoaded", function () {
    // ì €ì¥ëœ ì¥ì†Œ ë°ì´í„° ë¡œë“œ
    fetch("/api/mymap")
        .then((response) => response.json())
        .then((data) => {
            const savedLocations = document.getElementById("savedLocations");
            data.forEach((location) => {
                const option = document.createElement("option");
                option.value = location.locationName; // ì¥ì†Œ ì´ë¦„
                option.textContent = location.locationName; // í‘œì‹œ í…ìŠ¤íŠ¸
                savedLocations.appendChild(option);
            });
        })
        .catch((error) => console.error("Error fetching locations:", error));

    // ë³„ì  ì„ íƒ ì´ë²¤íŠ¸ ì¶”ê°€
    const stars = document.querySelectorAll(".rating-stars span");
    stars.forEach((star, index) => {
        star.addEventListener("click", function () {
            console.log(`Star clicked: ${index + 1}`); // ë””ë²„ê¹… ë¡œê·¸
            selectStars(index + 1); // í´ë¦­í•œ ë³„ê¹Œì§€ ì„ íƒ
        });
    });
});

// ë³„ì  ì„ íƒ í•¨ìˆ˜
function selectStars(rating) {
    const stars = document.querySelectorAll(".rating-stars span");
    stars.forEach((star, index) => {
        if (index < rating) {
            star.classList.add("selected"); // ì„ íƒëœ ë³„ í‘œì‹œ
        } else {
            star.classList.remove("selected"); // ì„ íƒë˜ì§€ ì•Šì€ ë³„ í‘œì‹œ
        }
    });
}

//ë¦¬ë·° ë“±ë¡ í•¨ìˆ˜
function submitReview() {
    const selectedLocation = document.getElementById("savedLocations").value;
    const reviewText = document.getElementById("reviewText").value;
    const ratingStars = document.querySelectorAll(".rating-stars span.selected").length;

    if (!selectedLocation) {
        alert("ì¥ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
    }

    if (!reviewText) {
        alert("ë¦¬ë·° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    if (ratingStars === 0) {
        alert("ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
    }

    // ë¦¬ë·° ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì „ì†¡
    fetch("/api/saveReview", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({
            locationName: selectedLocation,
            reviewText: reviewText,
            rating: ratingStars,
        }),
    })
        .then((response) => {
            if (!response.ok) {
                throw new Error("ë¦¬ë·° ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
            }
            return response.json(); // JSON ì‘ë‹µ ì²˜ë¦¬
        })
        .then((data) => {
            alert(data.message); // ì„œë²„ ì‘ë‹µ ë©”ì‹œì§€ë¥¼ ì•Œë¦¼ìœ¼ë¡œ í‘œì‹œ
            loadReviews(selectedLocation); // ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ ê°±ì‹ 
        })
        .catch((error) => console.error("Error submitting review:", error));
}

document.getElementById("savedLocations").addEventListener("change", function () {
    const selectedLocation = this.value;
    if (selectedLocation) {
        loadReviews(selectedLocation); // ì„ íƒëœ ì¥ì†Œì˜ ë¦¬ë·° ê°€ì ¸ì˜¤ê¸°
    }
});


function loadReviews(locationName, listItem) {
    console.log("Loading reviews for location:", locationName);

    fetch(`/api/reviews?locationName=${encodeURIComponent(locationName)}`)
        .then((response) => response.json())
        .then((reviews) => {
            console.log("Received reviews:", reviews);

            const reviewList = listItem.querySelector(".review-list");
            reviewList.innerHTML = ""; // ê¸°ì¡´ ë¦¬ë·° ì´ˆê¸°í™”

            // ë³„ì  í‰ê·  ê³„ì‚°
            const totalRating = reviews.reduce((sum, review) => sum + review.rating, 0);
            const averageRating = reviews.length > 0 ? (totalRating / reviews.length).toFixed(1) : 0;

            // ë³„ì  í‰ê·  ì„¹ì…˜ ì—…ë°ì´íŠ¸
            const starsElement = listItem.querySelector(".average-rating .stars");
            const valueElement = listItem.querySelector(".average-rating .value");

            // ë³„ì  í‘œì‹œ ë¡œì§
            if (reviews.length > 0) {
                starsElement.textContent = "â­".repeat(Math.floor(averageRating)) + (averageRating % 1 >= 0.5 ? "â˜†" : "");
                valueElement.textContent = `${averageRating}/5`;
            } else {
                starsElement.textContent = "â­â˜†â˜†â˜†â˜†"; // ê¸°ë³¸ê°’ (í‰ê°€ ì—†ìŒ)
                valueElement.textContent = "0/5";
            }

            // ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ ìƒì„±
            if (reviews.length === 0) {
                reviewList.innerHTML = `<p>ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }

            reviews.forEach((review) => {
                const reviewItem = document.createElement("div");
                reviewItem.classList.add("review-item");
                reviewItem.innerHTML = `
                    <div class="review-author">${review.author}</div>
                    <div class="review-rating">${"â­".repeat(review.rating)}</div>
                    <div class="review-text">${review.text}</div>
                `;
                reviewList.appendChild(reviewItem);
            });
        })
        .catch((error) => {
            console.error("Error loading reviews:", error);

            const reviewList = listItem.querySelector(".review-list");
            reviewList.innerHTML = `<p>ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>`;

            // í‰ê·  ë³„ì ë„ ì´ˆê¸°í™”
            const starsElement = listItem.querySelector(".average-rating .stars");
            const valueElement = listItem.querySelector(".average-rating .value");
            starsElement.textContent = "â­â˜†â˜†â˜†â˜†";
            valueElement.textContent = "0/5";
        });
}

function fetchAverageRating(locationName) {
    fetch(`/api/reviews?locationName=${encodeURIComponent(locationName)}`)
        .then((response) => response.json())
        .then((reviews) => {
            // í‰ê·  ë³„ì  ê³„ì‚°
            const totalRating = reviews.reduce((sum, review) => sum + review.rating, 0);
            const averageRating = reviews.length > 0 ? (totalRating / reviews.length).toFixed(1) : 0;

            // ì˜¤ë²„ë ˆì´ ë‚´ ë³„ì  í‘œì‹œ ì—…ë°ì´íŠ¸
            const starsContainer = document.getElementById('average-stars');
            const ratingText = document.getElementById('average-rating');

            if (starsContainer && ratingText) {
                starsContainer.innerHTML = ''; // ê¸°ì¡´ ë³„ ì´ˆê¸°í™”
                ratingText.textContent = `${averageRating} / 5`; // ìˆ«ì ì ìˆ˜ ì—…ë°ì´íŠ¸

                const fullStars = Math.floor(averageRating); // ê½‰ ì°¬ ë³„
                const halfStar = averageRating % 1 >= 0.5; // ë°˜ìª½ ë³„ ì—¬ë¶€
                const emptyStars = 5 - fullStars - (halfStar ? 1 : 0); // ë¹ˆ ë³„

                // ê½‰ ì°¬ ë³„ ì¶”ê°€
                for (let i = 0; i < fullStars; i++) {
                    const star = document.createElement('span');
                    star.classList.add('filled');
                    starsContainer.appendChild(star);
                }

                // ë°˜ìª½ ë³„ ì¶”ê°€
                if (halfStar) {
                    const star = document.createElement('span');
                    star.classList.add('half'); // CSSë¡œ ë°˜ìª½ ë³„ ìŠ¤íƒ€ì¼ë§
                    starsContainer.appendChild(star);
                }

                // ë¹ˆ ë³„ ì¶”ê°€
                for (let i = 0; i < emptyStars; i++) {
                    const star = document.createElement('span');
                    starsContainer.appendChild(star);
                }
            }
        })
        .catch((error) => {
            console.error("Error fetching average rating:", error);

            const starsContainer = document.getElementById('average-stars');
            const ratingText = document.getElementById('average-rating');

            if (starsContainer) {
                starsContainer.innerHTML = ''; // ë³„ ì´ˆê¸°í™”
            }

            if (ratingText) {
                ratingText.textContent = "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";
            }
        });
}
async function checkNotifications() {
    try {
        const response = await fetch('/notifications/pending');
        const data = await response.json();

        if (response.ok) {
            const friendRequests = data.friendRequests || 0;
            const groupRequests = data.groupRequests || 0;
            const messageRequests = data.messageRequests || 0;

            // ì¹œêµ¬ ìš”ì²­ ë°°ì§€ ì—…ë°ì´íŠ¸
            const friendBadge = document.getElementById('friend-badge');
            friendBadge.textContent = friendRequests > 0 ? friendRequests : '';
            friendBadge.style.display = friendRequests > 0 ? 'inline' : 'none';

            // ê·¸ë£¹ ìš”ì²­ ë°°ì§€ ì—…ë°ì´íŠ¸
            const groupBadge = document.getElementById('group-badge');
            groupBadge.textContent = groupRequests > 0 ? groupRequests : '';
            groupBadge.style.display = groupRequests > 0 ? 'inline' : 'none';
            
            // ìª½ì§€ ë°°ì§€ ì—…ë°ì´íŠ¸
            const messageBadge = document.getElementById('message-badge');
            messageBadge.textContent = messageRequests > 0 ? messageRequests : '';
            messageBadge.style.display = messageRequests > 0 ? 'inline' : 'none';
        } else {
            console.error('Error fetching notifications:', data);
        }
    } catch (error) {
        console.error('Error fetching notifications:', error);
    }
}
function findmyLocation() {
    if (!navigator.geolocation) {
        alert("Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
        return;
    }

    navigator.geolocation.getCurrentPosition(
        (position) => {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            // ì§€ë„ ì¤‘ì‹¬ ì´ë™
            const coords = new kakao.maps.LatLng(latitude, longitude);
            map.setCenter(coords);

            // ë§ˆì»¤ ì¶”ê°€
            const marker = new kakao.maps.Marker({
                position: coords,
                map: map
            });

            // ë§ˆì»¤ í´ë¦­ ì‹œ í‘œì‹œí•  ì¸í¬ìœˆë„ìš°
            const infowindow = new kakao.maps.InfoWindow({
                content: `<div style="padding:5px;">ë‚´ ìœ„ì¹˜</div>`,
            });
            infowindow.open(map, marker);

            alert("í˜„ì¬ ìœ„ì¹˜ë¥¼ ì§€ë„ì— í‘œì‹œí–ˆìŠµë‹ˆë‹¤.");
        },
        (error) => {
            console.error("Error getting location:", error);
            alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }
    );
}
</script>
</body>
</html>